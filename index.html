<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lumen Studio ‚Äì IA Criativa</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* ... (todo o CSS permanece igual ao anterior) ... */
    /* Copie o CSS completo do √∫ltimo arquivo fornecido acima */
  </style>
</head>
<body>
  <header>
    <div class="logo">Lumen Studio</div>
    <button class="theme-toggle" id="theme-toggle" aria-label="Alternar tema">
      <span id="theme-icon">üåô</span>
    </button>
    <nav>
      <a href="#tts">Texto para √Åudio</a>
      <a href="#img">Texto para Imagem</a>
      <a href="#vid">Texto para V√≠deo</a>
    </nav>
  </header>
  <main>
    <section class="main-hero">
      <div class="main-title">Sua Central Criativa com IA</div>
      <div class="main-desc">Transforme texto em √°udio, imagem e v√≠deo de forma simples, r√°pida e profissional. Escolha o que quer criar:</div>
      <div class="options-panel">
        <div class="option-card selected" id="opt-tts">
          <span class="option-icon">üîä</span>
          <div class="option-title">Texto para √Åudio</div>
          <div class="option-desc">Converta textos em vozes realistas e premium.</div>
        </div>
        <div class="option-card" id="opt-img">
          <span class="option-icon">üñºÔ∏è</span>
          <div class="option-title">Texto para Imagem</div>
          <div class="option-desc">Gere imagens √∫nicas a partir de descri√ß√µes.</div>
        </div>
        <div class="option-card" id="opt-vid">
          <span class="option-icon">üé¨</span>
          <div class="option-title">Texto para V√≠deo</div>
          <div class="option-desc">Transforme roteiros em v√≠deos automaticamente.</div>
        </div>
      </div>
    </section>
    <!-- Texto para √Åudio -->
    <section class="section-module active" id="module-tts">
      <h2 style="text-align:center; font-size:1.25rem; margin-bottom:22px;">Texto para √Åudio (TTS)</h2>
      <div class="input-group">
        <label for="text-input">Digite seu texto:</label>
        <textarea id="text-input" placeholder="Escreva aqui o texto que deseja converter em voz...">Ol√°! Esta √© uma demonstra√ß√£o do sistema de texto para voz com vozes premium.</textarea>
      </div>
      <div class="input-group">
        <label>Selecione a voz:</label>
        <div class="voice-options">
          <div class="voice-option selected" data-voice="EXAVITQu4vr4xnSDxMaL">
            <div class="voice-name">Bianca (BR)</div>
            <div class="voice-desc">Voz feminina natural</div>
          </div>
          <div class="voice-option" data-voice="VR6AewLTigWG4xSOukaG">
            <div class="voice-name">Ant√¥nio (BR)</div>
            <div class="voice-desc">Voz masculina clara</div>
          </div>
          <div class="voice-option" data-voice="MF3mGyEYCl7XYWbV9V6O">
            <div class="voice-name">L√∫cia (PT)</div>
            <div class="voice-desc">Sotaque portugu√™s</div>
          </div>
          <div class="voice-option" data-voice="Wa8JcdAKK7NzSC0jv3Bs">
            <div class="voice-name">Minha Voz</div>
            <div class="voice-desc">Voz personalizada ElevenLabs</div>
          </div>
        </div>
      </div>
      <!-- Customiza√ß√£o de voz -->
      <div class="custom-controls">
        <div class="custom-control">
          <input type="checkbox" id="reverb">
          <label for="reverb">Reverb</label>
        </div>
        <div class="custom-control">
          <label for="desired-duration">Dura√ß√£o desejada (segundos):</label>
          <input type="number" min="5" max="300" step="1" id="desired-duration" placeholder="ex: 50">
        </div>
        <div class="custom-control">
          <label for="speed">Velocidade:</label>
          <input type="range" min="0.7" max="2.0" step="0.01" value="1" id="speed" />
          <span id="speed-value">1.00x</span>
          <span class="speed-suggestion" id="speed-suggestion"></span>
        </div>
      </div>
      <button id="generate-btn">Gerar √Åudio</button>
      <button class="api-key-trigger" id="open-apikey-btn">Mostrar chave API</button>
      <div id="loading" class="hidden">
        <div class="loader"></div>
        <p>Processando seu √°udio...</p>
      </div>
      <div id="error-message" class="hidden"></div>
      <div class="card hidden" id="result-card" style="background:none; box-shadow:none; border:none; margin:0;">
        <h3 style="text-align:center;">Resultado</h3>
        <!-- Barra de progresso -->
        <div id="progress-bar-container" class="hidden">
          <div id="progress-bar-bg">
            <div id="progress-bar-fill"></div>
          </div>
          <div id="progress-bar-label">0%</div>
        </div>
        <div id="audio-container">
          <audio id="audio-player" controls></audio>
          <a id="download-btn" class="download-btn hidden">‚¨áÔ∏è Baixar √Åudio</a>
          <a id="download-with-effect" class="download-btn hidden" style="background:#7B1FA2;">‚¨áÔ∏è Baixar com efeito</a>
          <button id="play-with-effect" class="download-btn hidden" style="background:#03a9f4; color:#fff; margin-top:12px;">‚ñ∂Ô∏è Reproduzir com efeito</button>
        </div>
      </div>
    </section>
    <!-- Modal da chave API -->
    <div class="api-key-modal-bg" id="apikey-modal-bg">
      <div class="api-key-modal">
        <button class="close-modal" id="close-apikey-modal" title="Fechar">&times;</button>
        <h3>Chave API ElevenLabs</h3>
        <label for="api-key">Chave API:</label>
        <input type="password" id="api-key" placeholder="Cole sua chave API aqui" autocomplete="off">
        <button class="show-hide-btn" id="toggle-api-key" title="Mostrar/ocultar chave" tabindex="0">
          <span id="eye-icon">&#128065;</span>
        </button>
        <small>
          Obtenha sua chave gratuita em <a href="https://elevenlabs.io/" target="_blank">elevenlabs.io</a>
        </small>
      </div>
    </div>
    <!-- Texto para Imagem -->
    <section class="section-module" id="module-img">
      <h2 style="text-align:center; font-size:1.18rem;">Texto para Imagem</h2>
      <div class="coming-soon">Em breve: gere imagens incr√≠veis a partir de qualquer descri√ß√£o!</div>
    </section>
    <!-- Texto para V√≠deo -->
    <section class="section-module" id="module-vid">
      <h2 style="text-align:center; font-size:1.18rem;">Texto para V√≠deo</h2>
      <div class="coming-soon">Em breve: transforme roteiros em v√≠deos automaticamente!</div>
    </section>
  </main>
  <footer>
    Desenvolvido com ‚ù§Ô∏è por Lumen Studio ‚Äì Powered by ElevenLabs.
  </footer>
  <script>
    // ... (todo o JS igual, exceto as linhas do impulse response)
    // Substitua TODAS as linhas:
    // const irUrl = 'https://cdn.jsdelivr.net/gh/joeeyjunior/public-assets@main/impulse-small.wav';
    // por:
    // const irUrl = 'https://cdn.jsdelivr.net/gh/ai-voice-assets/reverbs/ir-room-small.wav';

    // Exemplo nos pontos principais:
    async function applyReverb(audioElement) {
      if (currentAudioContext) { currentAudioContext.close(); }
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      currentAudioContext = audioCtx;
      const source = audioCtx.createMediaElementSource(audioElement);
      const convolver = audioCtx.createConvolver();
      convolverNode = convolver;
      const irUrl = 'https://cdn.jsdelivr.net/gh/ai-voice-assets/reverbs/ir-room-small.wav';
      const response = await fetch(irUrl);
      const arrayBuffer = await response.arrayBuffer();
      const irBuffer = await audioCtx.decodeAudioData(arrayBuffer);
      convolver.buffer = irBuffer;
      source.connect(convolver);
      convolver.connect(audioCtx.destination);
    }

    async function downloadAudioWithReverb(audioUrl, playbackRate = 1.0) {
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const response = await fetch(audioUrl);
      const arrayBuffer = await response.arrayBuffer();
      const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
      // impulse response
      const irResp = await fetch('https://cdn.jsdelivr.net/gh/ai-voice-assets/reverbs/ir-room-small.wav');
      const irBuf = await irResp.arrayBuffer();
      const irBuffer = await audioCtx.decodeAudioData(irBuf);
      const offlineCtx = new OfflineAudioContext(
        audioBuffer.numberOfChannels,
        Math.ceil(audioBuffer.length / playbackRate),
        audioBuffer.sampleRate
      );
      const source = offlineCtx.createBufferSource();
      source.buffer = audioBuffer;
      source.playbackRate.value = playbackRate;
      const convolver = offlineCtx.createConvolver();
      convolver.buffer = irBuffer;
      source.connect(convolver);
      convolver.connect(offlineCtx.destination);
      source.start(0);
      const renderedBuffer = await offlineCtx.startRendering();
      const wavBlob = bufferToWavBlob(renderedBuffer);
      const url = URL.createObjectURL(wavBlob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `lumen_audio_reverb_${Date.now()}.wav`;
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        URL.revokeObjectURL(url);
        document.body.removeChild(a);
      }, 1000);
    }

    let playEffectAudioContext = null;
    let playEffectSource = null;
    playWithEffectBtn.onclick = async function() {
      if (!audioPlayer.src) {
        alert("Gere o √°udio primeiro.");
        return;
      }
      try {
        if (playEffectAudioContext) {
          playEffectAudioContext.close();
          playEffectAudioContext = null;
          playEffectSource = null;
        }
        let playbackRate = parseFloat(speedInput.value);
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        playEffectAudioContext = audioCtx;
        const resp = await fetch(audioPlayer.src);
        if (!resp.ok) throw new Error("Erro ao carregar √°udio para efeito.");
        const arrayBuffer = await resp.arrayBuffer();
        const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
        // impulse response
        const irResp = await fetch('https://cdn.jsdelivr.net/gh/ai-voice-assets/reverbs/ir-room-small.wav');
        if (!irResp.ok) throw new Error("Erro ao carregar impulse response.");
        const irBuf = await irResp.arrayBuffer();
        const irBuffer = await audioCtx.decodeAudioData(irBuf);
        const source = audioCtx.createBufferSource();
        playEffectSource = source;
        source.buffer = audioBuffer;
        source.playbackRate.value = playbackRate;
        const convolver = audioCtx.createConvolver();
        convolver.buffer = irBuffer;
        source.connect(convolver);
        convolver.connect(audioCtx.destination);
        source.start(0);
        source.onended = () => {
          audioCtx.close();
          playEffectAudioContext = null;
          playEffectSource = null;
        };
      } catch (e) {
        alert("Falha ao reproduzir √°udio com efeito: " + e.message);
      }
    }

    // ... (restante do JS igual ao original, mantendo todas as fun√ß√µes e eventos)
    // N√£o se esque√ßa de trocar a URL do IR em todos os lugares!
  </script>
</body>
</html>
